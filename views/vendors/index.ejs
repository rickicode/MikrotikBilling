<%- include('../partials/header', { title: 'Manajemen Vendor', currentUrl: '/vendors' }) %>

<!-- Page Header -->
<div class="mb-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
        <div>
            <h1 class="text-3xl font-bold text-white mb-2">Manajemen Vendor</h1>
            <p class="text-slate-400">Kelola vendor dan supplier untuk sistem billing</p>
        </div>
        <div class="mt-4 sm:mt-0">
            <a href="/vendors/create" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg">
                <i class="fas fa-plus mr-2"></i>
                Tambah Vendor
            </a>
        </div>
    </div>
</div>

<!-- Search and Filter -->
<div class="bg-slate-800 border border-slate-700 rounded-xl p-6 mb-6 shadow-lg">
    <form method="GET" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="md:col-span-2">
            <label for="search" class="block text-sm font-medium text-slate-300 mb-2">Cari Vendor</label>
            <div class="relative">
                <input type="text" id="search" name="search"
                       value="<%= search %>" placeholder="Nama, kontak, telepon, email..."
                       class="w-full h-10 pl-10 pr-4 text-sm bg-slate-900 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:border-green-500 focus:ring-green-500 focus:outline-none focus:ring-2">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i class="fas fa-search text-slate-400"></i>
                </div>
            </div>
        </div>
        <div>
            <label for="status" class="block text-sm font-medium text-slate-300 mb-2">Status</label>
            <select id="status" name="status" class="w-full h-10 px-4 text-sm bg-slate-900 border border-slate-600 rounded-lg text-white focus:border-green-500 focus:ring-green-500 focus:outline-none focus:ring-2">
                <option value="">Semua Status</option>
                <option value="active" <%= status === 'active' ? 'selected' : '' %>>Aktif</option>
                <option value="inactive" <%= status === 'inactive' ? 'selected' : '' %>>Tidak Aktif</option>
            </select>
        </div>
        <div class="flex items-end space-x-2">
            <button type="submit" class="flex-1 h-10 px-4 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors duration-200">
                <i class="fas fa-search mr-2"></i>
                Cari
            </button>
            <a href="/vendors" class="inline-flex items-center justify-center h-10 px-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors duration-200">
                <i class="fas fa-times"></i>
            </a>
        </div>
    </form>
</div>

<!-- Success/Error Messages -->
<% if (typeof success !== 'undefined' && success) { %>
    <div class="mb-6 p-4 bg-green-500/10 border border-green-500/20 rounded-lg" role="alert">
        <div class="flex items-center">
            <i class="fas fa-check-circle text-green-400 mr-3"></i>
            <span class="text-green-200"><%= success %></span>
        </div>
    </div>
<% } %>
<% if (typeof error !== 'undefined' && error) { %>
    <div class="mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-lg" role="alert">
        <div class="flex items-center">
            <i class="fas fa-exclamation-triangle text-red-400 mr-3"></i>
            <span class="text-red-200"><%= error %></span>
        </div>
    </div>
<% } %>

<!-- Vendors Table -->
<div class="bg-slate-800 border border-slate-700 rounded-xl shadow-lg overflow-hidden">
    <div class="p-6">
        <% if (vendors.length === 0) { %>
            <div class="text-center py-12">
                <i class="fas fa-inbox text-6xl text-slate-500 mb-4"></i>
                <h3 class="text-xl font-semibold text-white mb-2">Tidak ada vendor ditemukan</h3>
                <p class="text-slate-400 mb-6">Silakan tambahkan vendor baru atau ubah parameter pencarian.</p>
                <a href="/vendors/create" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-plus mr-2"></i>
                    Tambah Vendor Pertama
                </a>
            </div>
        <% } else { %>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-slate-700">
                            <th class="px-6 py-4 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Nama Vendor</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Kontak Person</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Telepon</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Email</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Total Voucher</th>
                            <th class="px-6 py-4 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">Aksi</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-700">
                        <% vendors.forEach(vendor => { %>
                            <tr class="hover:bg-slate-700/50 transition-colors">
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        <div class="vendor-avatar mr-3">
                                            <%= vendor.name.charAt(0).toUpperCase() %>
                                        </div>
                                        <div>
                                            <div class="font-semibold text-white"><%= vendor.name %></div>
                                            <div class="text-xs text-slate-400">
                                                Dibuat: <%= new Date(vendor.created_at).toLocaleDateString('id-ID') %>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 text-slate-300"><%= vendor.contact_person || '-' %></td>
                                <td class="px-6 py-4 text-slate-300"><%= vendor.phone || '-' %></td>
                                <td class="px-6 py-4 text-slate-300"><%= vendor.email || '-' %></td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full <%= vendor.status === 'active' ? 'bg-green-500/10 text-green-400 border border-green-500/20' : 'bg-slate-500/10 text-slate-400 border border-slate-500/20' %>">
                                        <%= vendor.status === 'active' ? 'Aktif' : 'Tidak Aktif' %>
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="text-center">
                                        <div class="font-semibold text-white"><%= vendor.total_vouchers || 0 %></div>
                                        <div class="text-xs text-green-400">
                                            <%= vendor.active_vouchers || 0 %> aktif
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center justify-end space-x-2">
                                        <a href="/vendors/<%= vendor.id %>/edit"
                                           class="inline-flex items-center justify-center w-8 h-8 text-blue-400 hover:bg-blue-500/10 rounded-lg transition-colors"
                                           title="Edit Vendor">
                                            <i class="fas fa-edit text-sm"></i>
                                        </a>
                                        <form method="POST" action="/vendors/<%= vendor.id %>/toggle"
                                              class="inline" onsubmit="return confirm('Apakah Anda yakin ingin mengubah status vendor ini?')">
                                            <button type="submit"
                                                    class="inline-flex items-center justify-center w-8 h-8 <%= vendor.status === 'active' ? 'text-yellow-400 hover:bg-yellow-500/10' : 'text-green-400 hover:bg-green-500/10' %> rounded-lg transition-colors"
                                                    title="<%= vendor.status === 'active' ? 'Nonaktifkan' : 'Aktifkan' %> Vendor">
                                                <i class="fas fa-<%= vendor.status === 'active' ? 'pause' : 'play' %> text-sm"></i>
                                            </button>
                                        </form>
                                        <% if (vendor.total_vouchers == 0) { %>
                                            <form method="POST" action="/vendors/<%= vendor.id %>/delete"
                                                  class="inline" onsubmit="return confirm('Apakah Anda yakin ingin menghapus vendor ini?')">
                                                <button type="submit"
                                                        class="inline-flex items-center justify-center w-8 h-8 text-red-400 hover:bg-red-500/10 rounded-lg transition-colors"
                                                        title="Hapus Vendor">
                                                    <i class="fas fa-trash text-sm"></i>
                                                </button>
                                            </form>
                                        <% } %>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <% if (pagination.total > 1) { %>
                <nav aria-label="Page navigation" class="mt-6">
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-slate-400">
                            Menampilkan halaman <%= pagination.current %> dari <%= pagination.total %>
                        </div>
                        <div class="flex items-center space-x-2">
                            <% if (pagination.current > 1) { %>
                                <a href="?page=<%= pagination.current - 1 %>&search=<%= search %>&status=<%= status %>"
                                   class="inline-flex items-center justify-center w-10 h-10 text-slate-300 hover:bg-slate-700 rounded-lg transition-colors"
                                   aria-label="Previous page">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            <% } else { %>
                                <span class="inline-flex items-center justify-center w-10 h-10 text-slate-600 bg-slate-800 rounded-lg">
                                    <i class="fas fa-chevron-left"></i>
                                </span>
                            <% } %>

                            <% for (let i = Math.max(1, pagination.current - 2); i <= Math.min(pagination.total, pagination.current + 2); i++) { %>
                                <% if (i === pagination.current) { %>
                                    <span class="inline-flex items-center justify-center w-10 h-10 bg-green-600 text-white rounded-lg font-medium">
                                        <%= i %>
                                    </span>
                                <% } else { %>
                                    <a href="?page=<%= i %>&search=<%= search %>&status=<%= status %>"
                                       class="inline-flex items-center justify-center w-10 h-10 text-slate-300 hover:bg-slate-700 rounded-lg transition-colors">
                                        <%= i %>
                                    </a>
                                <% } %>
                            <% } %>

                            <% if (pagination.current < pagination.total) { %>
                                <a href="?page=<%= pagination.current + 1 %>&search=<%= search %>&status=<%= status %>"
                                   class="inline-flex items-center justify-center w-10 h-10 text-slate-300 hover:bg-slate-700 rounded-lg transition-colors"
                                   aria-label="Next page">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            <% } else { %>
                                <span class="inline-flex items-center justify-center w-10 h-10 text-slate-600 bg-slate-800 rounded-lg">
                                    <i class="fas fa-chevron-right"></i>
                                </span>
                            <% } %>
                        </div>
                    </div>
                </nav>
            <% } %>
        <% } %>
    </div>
</div>

<style>
.vendor-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 16px;
    flex-shrink: 0;
}
</style>

<%- include('../partials/footer') %>