<%- include('../partials/header', { title: 'Monitor', currentUrl: '/monitor' }) %>

<!-- Page Header -->
<div class="mb-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
        <div>
            <h1 class="text-3xl font-bold text-white mb-2">Monitor</h1>
            <p class="text-slate-400">Pantau real-time hotspot dan PPPoE users</p>
        </div>
        <div class="mt-4 sm:mt-0 flex gap-3">
            <button id="refreshMonitorBtn" class="inline-flex items-center px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors duration-200">
                <i class="fas fa-sync-alt mr-2"></i>
                Refresh
            </button>
            <button id="exportDataBtn" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200">
                <i class="fas fa-download mr-2"></i>
                Export
            </button>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="grid grid-cols-1 xl:grid-cols-3 lg:grid-cols-2 gap-6 mb-8">
    <!-- Hotspot Stats -->
    <div class="bg-gradient-to-br from-blue-600 to-blue-700 border border-blue-500 rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h3 class="text-blue-100 text-sm font-medium uppercase tracking-wider mb-2">Total Hotspot Users</h3>
                <div class="text-3xl font-bold text-white" id="totalHotspot">
                    <div class="w-8 h-8 border-2 border-blue-300 border-t-transparent rounded-full animate-spin"></div>
                </div>
            </div>
            <div class="w-16 h-16 bg-blue-500/20 rounded-xl flex items-center justify-center">
                <i class="fas fa-wifi text-blue-200 text-2xl"></i>
            </div>
        </div>

        <!-- Stats Breakdown -->
        <div class="grid grid-cols-3 gap-3">
            <div class="bg-green-500/10 border border-green-500/20 rounded-lg p-3 text-center">
                <div class="text-xl font-bold text-green-400" id="hotspotOnline">0</div>
                <div class="text-xs text-green-300">Online</div>
            </div>
            <div class="bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3 text-center">
                <div class="text-xl font-bold text-yellow-400" id="hotspotOfflineUsers">0</div>
                <div class="text-xs text-yellow-300">Offline</div>
            </div>
            <div class="bg-cyan-500/10 border border-cyan-500/20 rounded-lg p-3 text-center">
                <div class="text-xl font-bold text-cyan-400" id="hotspotSystemUsers">0</div>
                <div class="text-xs text-cyan-300">System</div>
            </div>
        </div>
    </div>

    <!-- PPPoE Stats -->
    <div class="bg-gradient-to-br from-yellow-600 to-yellow-700 border border-yellow-500 rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h3 class="text-yellow-100 text-sm font-medium uppercase tracking-wider mb-2">Total PPPoE Users</h3>
                <div class="text-3xl font-bold text-white" id="totalPPPoE">
                    <div class="w-8 h-8 border-2 border-yellow-300 border-t-transparent rounded-full animate-spin"></div>
                </div>
            </div>
            <div class="w-16 h-16 bg-yellow-500/20 rounded-xl flex items-center justify-center">
                <i class="fas fa-network-wired text-yellow-200 text-2xl"></i>
            </div>
        </div>

        <!-- Stats Breakdown -->
        <div class="grid grid-cols-3 gap-3">
            <div class="bg-green-500/10 border border-green-500/20 rounded-lg p-3 text-center">
                <div class="text-xl font-bold text-green-400" id="pppoeOnline">0</div>
                <div class="text-xs text-green-300">Online</div>
            </div>
            <div class="bg-red-500/10 border border-red-500/20 rounded-lg p-3 text-center">
                <div class="text-xl font-bold text-red-400" id="pppoeOfflineUsers">0</div>
                <div class="text-xs text-red-300">Offline</div>
            </div>
            <div class="bg-cyan-500/10 border border-cyan-500/20 rounded-lg p-3 text-center">
                <div class="text-xl font-bold text-cyan-400" id="pppoeSystemUsers">0</div>
                <div class="text-xs text-cyan-300">System</div>
            </div>
        </div>
    </div>

    <!-- Total Online Stats -->
    <div class="bg-gradient-to-br from-slate-700 to-slate-800 border border-slate-600 rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300 xl:col-span-1 lg:col-span-2">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h3 class="text-slate-300 text-sm font-medium uppercase tracking-wider mb-2">Total Online Sessions</h3>
                <div class="text-3xl font-bold text-white" id="totalOnlineAll">
                    <div class="w-8 h-8 border-2 border-slate-400 border-t-transparent rounded-full animate-spin"></div>
                </div>
            </div>
            <div class="w-16 h-16 bg-slate-600/20 rounded-xl flex items-center justify-center">
                <i class="fas fa-globe text-slate-300 text-2xl"></i>
            </div>
        </div>

        <!-- Stats Breakdown -->
        <div class="grid grid-cols-2 gap-3">
            <div class="bg-slate-600/10 border border-slate-500/20 rounded-lg p-3 text-center">
                <div class="text-xl font-bold text-slate-300" id="totalHotspotOnlineAll">0</div>
                <div class="text-xs text-slate-400">Hotspot All</div>
            </div>
            <div class="bg-slate-500/10 border border-slate-400/20 rounded-lg p-3 text-center">
                <div class="text-xl font-bold text-slate-300" id="totalPPPoEOnlineAll">0</div>
                <div class="text-xs text-slate-400">PPPoE All</div>
            </div>
        </div>
    </div>
</div>

<!-- Real-time Sessions -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
    <!-- Hotspot Sessions -->
    <div class="lg:col-span-2">
        <div class="bg-slate-800 border border-slate-700 rounded-xl shadow-lg">
            <div class="px-6 py-4 border-b border-slate-700 bg-slate-900/30 flex items-center justify-between">
                <h2 class="text-xl font-semibold text-white">Sesi Aktif - Hotspot</h2>
                <span class="inline-flex items-center px-3 py-1 <%= mikrotikConnected ? 'bg-green-500/10 text-green-400 border-green-500/20' : 'bg-red-500/10 text-red-400 border-red-500/20' %> rounded-full text-sm border" id="hotspotConnectionStatus">
                    <i class="fas fa-wifi mr-2"></i>
                    <%= mikrotikConnected ? 'Terhubung' : 'Tidak Terhubung' %>
                </span>
            </div>
            <div class="p-6">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-slate-700">
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Username</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">IP Address</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">MAC Address</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Login Time</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Uptime</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Bytes In/Out</th>
                            </tr>
                        </thead>
                        <tbody id="hotspotSessionsTableBody" class="divide-y divide-slate-700">
                            <tr>
                                <td colspan="6" class="px-4 py-8 text-center text-slate-400">
                                    <div class="inline-flex items-center">
                                        <div class="w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mr-3"></div>
                                        Memuat data sesi hotspot...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- PPPoE Sessions & System Status -->
    <div class="space-y-6">
        <!-- PPPoE Sessions -->
        <div class="bg-slate-800 border border-slate-700 rounded-xl shadow-lg">
            <div class="px-6 py-4 border-b border-slate-700 bg-slate-900/30 flex items-center justify-between">
                <h2 class="text-xl font-semibold text-white">Sesi Aktif - PPPoE</h2>
                <span class="inline-flex items-center px-3 py-1 <%= mikrotikConnected ? 'bg-green-500/10 text-green-400 border-green-500/20' : 'bg-red-500/10 text-red-400 border-red-500/20' %> rounded-full text-sm border" id="pppoeConnectionStatus">
                    <i class="fas fa-network-wired mr-2"></i>
                    <%= mikrotikConnected ? 'Terhubung' : 'Tidak Terhubung' %>
                </span>
            </div>
            <div class="p-6">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-slate-700">
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Username</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Address</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Uptime</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Encoding</th>
                            </tr>
                        </thead>
                        <tbody id="pppoeSessionsTableBody" class="divide-y divide-slate-700">
                            <tr>
                                <td colspan="4" class="px-4 py-8 text-center text-slate-400">
                                    <div class="inline-flex items-center">
                                        <div class="w-6 h-6 border-2 border-yellow-500 border-t-transparent rounded-full animate-spin mr-3"></div>
                                        Memuat data sesi PPPoE...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="bg-slate-800 border border-slate-700 rounded-xl shadow-lg">
            <div class="px-6 py-4 border-b border-slate-700 bg-slate-900/30">
                <h2 class="text-xl font-semibold text-white">System Status</h2>
            </div>
            <div class="p-6 space-y-4">
                <div class="flex justify-between items-center py-2 border-b border-slate-700">
                    <span class="text-sm text-slate-400">RouterOS Identity</span>
                    <span class="text-sm font-medium text-white" id="routerOSIdentity"><%= routerOSIdentity %></span>
                </div>

                <div class="flex justify-between items-center py-2 border-b border-slate-700">
                    <span class="text-sm text-slate-400">RouterOS Version</span>
                    <span class="text-sm text-slate-300" id="routerOSVersion"><%= routerOSVersion %></span>
                </div>

                <div class="flex justify-between items-center py-2 border-b border-slate-700">
                    <span class="text-sm text-slate-400">System Uptime</span>
                    <span class="text-sm text-slate-300" id="routerOSUptime"><%= routerOSUptime %></span>
                </div>

                <div class="py-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-slate-400">Mikrotik Connection</span>
                        <span class="inline-flex items-center px-2 py-1 <%= mikrotikConnected ? 'bg-green-500/10 text-green-400 border-green-500/20' : 'bg-red-500/10 text-red-400 border-red-500/20' %> rounded-full text-xs border" id="mikrotikStatus">
                            <i class="fas fa-<%= mikrotikConnected ? 'check' : 'times' %> mr-1"></i>
                            <%= mikrotikConnected ? 'Connected' : (connectionStatus === 'not_configured' ? 'Not Configured' : 'Disconnected') %>
                        </span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-1">
                        <div class="<%= mikrotikConnected ? 'bg-green-500' : 'bg-red-500' %> h-1 rounded-full" style="width: <%= mikrotikConnected ? '100' : '30' %>%"></div>
                    </div>
                </div>

                <div class="py-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-slate-400">API Response</span>
                        <span class="inline-flex items-center px-2 py-1 bg-blue-500/10 text-blue-400 rounded-full text-xs border border-blue-500/20" id="apiResponseTime">120ms</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-1">
                        <div class="bg-blue-500 h-1 rounded-full" style="width: 85%"></div>
                    </div>
                </div>

                <div class="flex justify-between items-center py-2">
                    <span class="text-sm text-slate-400">Last Update</span>
                    <span class="text-sm text-slate-300" id="lastUpdate">Baru saja</span>
                </div>

                <div class="pt-4 border-t border-slate-700">
                    <button id="runConnectionTestBtn" class="w-full inline-flex items-center justify-center px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors duration-200">
                        <i class="fas fa-tools mr-2"></i>
                        Test Connection
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- User Management Overview -->
<div class="bg-slate-800 border border-slate-700 rounded-xl shadow-lg">
    <div class="px-6 py-4 border-b border-slate-700 bg-slate-900/30 flex items-center justify-between">
        <h2 class="text-xl font-semibold text-white">User Management Overview</h2>
        <div class="flex gap-3">
            <button id="cleanupExpiredBtn" class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors duration-200">
                <i class="fas fa-trash mr-2"></i>
                Cleanup Expired
            </button>
            <button id="syncMikrotikBtn" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200">
                <i class="fas fa-sync mr-2"></i>
                Sync Mikrotik
            </button>
        </div>
    </div>
    <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="text-center p-6 bg-blue-500/10 border border-blue-500/20 rounded-lg">
                <div class="text-3xl font-bold text-blue-400 mb-2" id="activeHotspotUsers">-</div>
                <div class="text-sm text-blue-300">Hotspot Users (Aktif)</div>
            </div>
            <div class="text-center p-6 bg-yellow-500/10 border border-yellow-500/20 rounded-lg">
                <div class="text-3xl font-bold text-yellow-400 mb-2" id="expiredHotspotUsers">-</div>
                <div class="text-sm text-yellow-300">Hotspot Users (Expired)</div>
            </div>
            <div class="text-center p-6 bg-green-500/10 border border-green-500/20 rounded-lg">
                <div class="text-3xl font-bold text-green-400 mb-2" id="activePPPoEUsers">-</div>
                <div class="text-sm text-green-300">PPPoE Users (Aktif)</div>
            </div>
            <div class="text-center p-6 bg-red-500/10 border border-red-500/20 rounded-lg">
                <div class="text-3xl font-bold text-red-400 mb-2" id="disabledPPPoEUsers">-</div>
                <div class="text-sm text-red-300">PPPoE Users (Disabled)</div>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-slate-800 border border-slate-700 rounded-xl max-w-md w-full">
            <div class="px-6 py-4 border-b border-slate-700 flex items-center justify-between">
                <h3 class="text-xl font-semibold text-white" id="confirmModalTitle">Konfirmasi</h3>
                <button onclick="closeConfirmModal()" class="text-slate-400 hover:text-white transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6">
                <p class="text-slate-300" id="confirmModalBody">Apakah Anda yakin ingin melanjutkan tindakan ini?</p>
            </div>
            <div class="px-6 py-4 border-t border-slate-700 flex justify-end space-x-3">
                <button onclick="closeConfirmModal()" class="px-4 py-2 text-slate-300 hover:text-white hover:bg-slate-700 rounded-lg transition-colors">
                    Batal
                </button>
                <button id="confirmModalBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200">
                    <i class="fas fa-check mr-2"></i>
                    Ya
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Notification Container -->
<div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-slate-800 border border-slate-700 rounded-xl p-6 flex items-center space-x-4 shadow-2xl">
        <div class="animate-spin rounded-full h-10 w-10 border-4 border-slate-600 border-t-blue-500"></div>
        <div>
            <span class="text-slate-200 font-medium">Processing...</span>
            <p class="text-slate-400 text-sm mt-1">Mohon tunggu sebentar</p>
        </div>
    </div>
</div>

<%- include('../partials/footer', { scripts: ['/public/js/monitor.js'] }) %>